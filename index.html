<!-- ui.html -->
<!DOCTYPE html>
<html>

<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 16px 16px 12px 16px;
      color: #1E1E1E;
      background: #FFFFFF;
      font-size: 11px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* Dark mode styles */
    body.dark-mode {
      color: #FFFFFF;
      background: #2C2C2C;
    }

    body.dark-mode h2 {
      color: #FFFFFF;
    }

    body.dark-mode .slider-label {
      color: #CCCCCC;
    }

    body.dark-mode .option-label {
      color: #CCCCCC;
    }

    body.dark-mode .option-label:hover {
      color: #FFFFFF;
    }

    body.dark-mode .percent-input {
      background: #1E1E1E;
      border-color: #3C3C3C;
      color: #FFFFFF;
    }

    body.dark-mode .percent-input:hover {
      border-color: #555555;
    }

    body.dark-mode .percent-symbol {
      color: #7C7C7C;
    }

    body.dark-mode .checkbox-custom {
      background: #1E1E1E;
      border-color: #555555;
    }

    body.dark-mode .checkbox-wrapper:hover .checkbox-custom {
      border-color: #7C7C7C;
    }

    body.dark-mode input[type="range"]::-webkit-slider-runnable-track {
      background: linear-gradient(to right, rgba(24, 160, 251, 0.35) 0%, rgba(24, 160, 251, 0.35) var(--progress), #3C3C3C var(--progress), #3C3C3C 100%);
    }

    body.dark-mode input[type="range"]:hover::-webkit-slider-runnable-track {
      background: linear-gradient(to right, rgba(13, 143, 232, 0.45) 0%, rgba(13, 143, 232, 0.45) var(--progress), #4C4C4C var(--progress), #4C4C4C 100%);
    }

    body.dark-mode input[type="range"]::-moz-range-track {
      background: #3C3C3C;
    }

    body.dark-mode input[type="range"]:hover::-moz-range-track {
      background: #4C4C4C;
    }

    body.dark-mode input[type="range"]::-webkit-slider-thumb {
      background: #2C2C2C;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode input[type="range"]::-webkit-slider-thumb:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    body.dark-mode input[type="range"]::-moz-range-thumb {
      background: #2C2C2C;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode input[type="range"]::-moz-range-thumb:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    body.dark-mode .divider {
      background: #3C3C3C;
    }

    body.dark-mode .tooltip {
      background: #3C3C3C;
      color: #CCCCCC;
    }

    body.dark-mode .tooltip:hover {
      background: #4C4C4C;
      color: #FFFFFF;
    }

    body.dark-mode .tooltip .tooltiptext {
      background-color: #1E1E1E;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    body.dark-mode .tooltip .tooltiptext::after {
      border-color: #1E1E1E transparent transparent transparent;
    }

    body.dark-mode .slider-label-text::after,
    body.dark-mode button.has-tooltip::after,
    body.dark-mode .footer a::after {
      background: #1E1E1E;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }

    body.dark-mode .slider-label-text::before,
    body.dark-mode button.has-tooltip::before,
    body.dark-mode .footer a::before {
      border-color: #1E1E1E transparent transparent transparent;
    }

    body.dark-mode #cancel-btn {
      background: #3C3C3C;
      color: #CCCCCC;
    }

    body.dark-mode #cancel-btn:hover {
      background: #4C4C4C;
      color: #FFFFFF;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode .footer {
      border-top-color: #3C3C3C;
      color: #7C7C7C;
    }

    h2 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #1E1E1E;
      letter-spacing: -0.01em;
    }

    .slider-container {
      margin-bottom: 16px;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 11px;
      font-weight: 500;
      color: #333333;
    }

    .slider-label-text {
      position: relative;
      cursor: help;
    }

    .slider-label-text::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 0;
      bottom: calc(100% + 6px);
      background: #1E1E1E;
      color: #FFFFFF;
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
      pointer-events: none;
    }

    .slider-label-text::before {
      content: '';
      position: absolute;
      left: 8px;
      bottom: calc(100% + 2px);
      border-width: 4px;
      border-style: solid;
      border-color: #1E1E1E transparent transparent transparent;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
    }

    .slider-label-text:hover::after,
    .slider-label-text:hover::before {
      opacity: 1;
      visibility: visible;
    }

    .input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .percent-input {
      width: 48px;
      height: 28px;
      border: 1px solid #E5E5E5;
      border-radius: 4px;
      padding: 0 20px 0 8px;
      font-size: 11px;
      text-align: right;
      font-family: inherit;
      color: #1E1E1E;
      background: #FFFFFF;
      transition: all 0.15s ease;
      outline: none;
    }

    .percent-input:hover {
      border-color: #CCCCCC;
    }

    .percent-input:focus {
      border-color: #18A0FB;
      box-shadow: 0 0 0 1px #18A0FB;
    }

    .percent-symbol {
      position: absolute;
      right: 8px;
      font-size: 11px;
      color: #999999;
      pointer-events: none;
    }

    .slider-wrapper {
      position: relative;
      width: 100%;
      height: 20px;
      margin: 8px 0 0 0;
      display: flex;
      align-items: center;
    }

    .slider-track {
      position: absolute;
      top: 50%;
      left: 0;
      width: 50%;
      height: 4px;
      background: linear-gradient(90deg, #18A0FB 0%, #18A0FB 100%);
      border-radius: 2px;
      transform: translateY(-50%);
      pointer-events: none;
      z-index: 0;
      transition: width 0.15s ease;
    }

    input[type="range"] {
      --progress: 0%;
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 20px;
      background: transparent;
      outline: none;
      cursor: pointer;
      position: relative;
      z-index: 1;
      margin: 0;
      padding: 0;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      background: linear-gradient(to right, rgba(24, 160, 251, 0.35) 0%, rgba(24, 160, 251, 0.35) var(--progress), #E5E5E5 var(--progress), #E5E5E5 100%);
      border-radius: 2px;
      cursor: pointer;
      border: none;
    }

    input[type="range"]:hover::-webkit-slider-runnable-track {
      background: linear-gradient(to right, rgba(13, 143, 232, 0.45) 0%, rgba(13, 143, 232, 0.45) var(--progress), #D9D9D9 var(--progress), #D9D9D9 100%);
    }

    input[type="range"]::-moz-range-track {
      width: 100%;
      height: 4px;
      background: #E5E5E5;
      border-radius: 2px;
      cursor: pointer;
      border: none;
    }

    input[type="range"]:hover::-moz-range-track {
      background: #D9D9D9;
    }

    input[type="range"]::-moz-range-progress {
      height: 4px;
      background: rgba(24, 160, 251, 0.35);
      border-radius: 2px;
    }

    input[type="range"]:hover::-moz-range-progress {
      background: rgba(13, 143, 232, 0.45);
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #FFFFFF;
      border: 2px solid #18A0FB;
      border-radius: 50%;
      cursor: pointer;
      margin-top: -6px;
      transition: all 0.15s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.16);
    }

    input[type="range"]::-webkit-slider-thumb:active {
      transform: scale(1.05);
      background: #18A0FB;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #FFFFFF;
      border: 2px solid #18A0FB;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.15s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
    }

    input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.16);
    }

    input[type="range"]::-moz-range-thumb:active {
      transform: scale(1.05);
      background: #18A0FB;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    .divider {
      height: 1px;
      background: #E5E5E5;
      margin: 16px 0;
    }

    .option-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .option-label {
      display: flex;
      align-items: center;
      font-size: 11px;
      font-weight: 500;
      color: #333333;
      cursor: pointer;
      user-select: none;
      transition: color 0.15s ease;
    }

    .option-label:hover {
      color: #1E1E1E;
    }

    /* Custom checkbox */
    .checkbox-wrapper {
      position: relative;
      display: inline-block;
      width: 16px;
      height: 16px;
      margin-right: 8px;
    }

    .checkbox-wrapper input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      width: 100%;
      height: 100%;
      margin: 0;
    }

    .checkbox-custom {
      position: absolute;
      top: 0;
      left: 0;
      width: 16px;
      height: 16px;
      background: #FFFFFF;
      border: 1.5px solid #CCCCCC;
      border-radius: 3px;
      transition: all 0.15s ease;
      pointer-events: none;
    }

    .checkbox-wrapper:hover .checkbox-custom {
      border-color: #999999;
    }

    .checkbox-wrapper input[type="checkbox"]:checked~.checkbox-custom {
      background: #18A0FB;
      border-color: #18A0FB;
    }

    .checkbox-custom::after {
      content: '';
      position: absolute;
      display: none;
      left: 4px;
      top: 1px;
      width: 4px;
      height: 8px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .checkbox-wrapper input[type="checkbox"]:checked~.checkbox-custom::after {
      display: block;
    }

    .tooltip {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: #F0F0F0;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 600;
      color: #666666;
      cursor: help;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }

    .tooltip:hover {
      background: #E5E5E5;
      color: #333333;
      transform: scale(1.1);
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 220px;
      max-width: calc(100vw - 32px);
      background-color: #1E1E1E;
      color: #FFFFFF;
      text-align: left;
      border-radius: 6px;
      padding: 8px 10px;
      position: fixed;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
      font-size: 11px;
      line-height: 1.4;
      font-weight: 400;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      pointer-events: none;
    }

    .tooltip .tooltiptext::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -4px;
      border-width: 4px;
      border-style: solid;
      border-color: #1E1E1E transparent transparent transparent;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    button.has-tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 50%;
      bottom: calc(100% + 8px);
      transform: translateX(-50%);
      background: #1E1E1E;
      color: #FFFFFF;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
      pointer-events: none;
    }

    button.has-tooltip::before {
      content: '';
      position: absolute;
      left: 50%;
      bottom: calc(100% + 4px);
      transform: translateX(-50%);
      border-width: 4px;
      border-style: solid;
      border-color: #1E1E1E transparent transparent transparent;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
    }

    button.has-tooltip:hover::after,
    button.has-tooltip:hover::before {
      opacity: 1;
      visibility: visible;
    }

    .button-container {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    button {
      flex: 1;
      height: 32px;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s ease;
      outline: none;
      position: relative;
      overflow: hidden;
    }

    button:not(.has-tooltip):not(.support-button)::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }

    button:not(.has-tooltip):not(.support-button):active::before {
      width: 200px;
      height: 200px;
    }

    #cancel-btn {
      background: #F5F5F5;
      color: #333333;
    }

    #cancel-btn:hover {
      background: #E5E5E5;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    #cancel-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    #apply-btn {
      background: #18A0FB;
      color: #FFFFFF;
    }

    #apply-btn:hover {
      background: #0D8FE8;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(24, 160, 251, 0.35);
    }

    #apply-btn:active {
      transform: translateY(0);
      background: #0B7FD1;
      box-shadow: none;
    }

    .randomize-btn {
      flex: 1;
      height: 26px;
      background: #F5F5F5;
      color: #333333;
      font-size: 11px;
      font-weight: 600;
    }

    .randomize-btn:hover:not(:disabled) {
      background: #E5E5E5;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .randomize-btn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: none;
    }

    .randomize-btn:disabled {
      background: #F5F5F5;
      color: #CCCCCC;
      cursor: not-allowed;
      opacity: 0.5;
    }

    body.dark-mode .randomize-btn {
      background: #3C3C3C;
      color: #CCCCCC;
    }

    body.dark-mode .randomize-btn:hover:not(:disabled) {
      background: #4C4C4C;
      color: #FFFFFF;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode .randomize-btn:disabled {
      background: #2C2C2C;
      color: #666666;
    }

    .footer {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px solid #E5E5E5;
      text-align: center;
      font-size: 10px;
      color: #999999;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
    }

    .support-button {
      position: absolute;
      right: 0;
      width: 20px;
      height: 20px;
      min-width: 20px;
      min-height: 20px;
      border-radius: 50%;
      background: #F0F0F0;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      transition: all 0.2s ease;
      outline: none;
      flex: none;
      overflow: visible;
    }

    .support-button:hover {
      transform: scale(1.15);
      background: #E5E5E5;
      box-shadow: none;
    }

    .support-button:active {
      transform: scale(1.05);
      box-shadow: none;
    }

    body.dark-mode .support-button {
      background: #3C3C3C;
    }

    body.dark-mode .support-button:hover {
      background: #4C4C4C;
    }

    .support-button svg {
      width: 16px;
      height: 16px;
      transition: all 0.2s ease;
    }

    .support-button:hover svg {
      fill: #18A0FB;
    }

    .support-button svg path,
    .support-button svg rect {
      fill: #999999;
      transition: fill 0.2s ease;
    }

    .support-button:hover svg path,
    .support-button:hover svg rect {
      fill: #18A0FB;
    }

    body.dark-mode .support-button svg path,
    body.dark-mode .support-button svg rect {
      fill: #7C7C7C;
    }

    body.dark-mode .support-button:hover svg path,
    body.dark-mode .support-button:hover svg rect {
      fill: #18A0FB;
    }

    .support-button[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      right: 0;
      bottom: calc(100% + 8px);
      background: #1E1E1E;
      color: #FFFFFF;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
      pointer-events: none;
    }

    .support-button[data-tooltip]::before {
      content: '';
      position: absolute;
      right: 6px;
      bottom: calc(100% + 4px);
      border-width: 4px;
      border-style: solid;
      border-color: #1E1E1E transparent transparent transparent;
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.5s, visibility 0.2s ease 0.5s;
    }

    .support-button[data-tooltip]:hover::after,
    .support-button[data-tooltip]:hover::before {
      opacity: 1;
      visibility: visible;
    }

    body.dark-mode .support-button[data-tooltip]::after {
      background: #1E1E1E;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }

    body.dark-mode .support-button[data-tooltip]::before {
      border-color: #1E1E1E transparent transparent transparent;
    }

    .footer a {
      color: #18A0FB;
      text-decoration: none;
      transition: all 0.15s ease;
      position: relative;
    }

    .footer a:hover {
      color: #0D8FE8;
      text-decoration: underline;
    }

    .footer a::after {
      content: 'Discover more design tools';
      position: absolute;
      left: 50%;
      bottom: calc(100% + 8px);
      transform: translateX(-50%);
      background: #1E1E1E;
      color: #FFFFFF;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.8s, visibility 0.2s ease 0.8s;
      pointer-events: none;
    }

    .footer a::before {
      content: '';
      position: absolute;
      left: 50%;
      bottom: calc(100% + 4px);
      transform: translateX(-50%);
      border-width: 4px;
      border-style: solid;
      border-color: #1E1E1E transparent transparent transparent;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease 0.8s, visibility 0.2s ease 0.8s;
    }

    .footer a:hover::after,
    .footer a:hover::before {
      opacity: 1;
      visibility: visible;
    }

    /* Smooth fade-in animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .slider-container {
      animation: fadeIn 0.3s ease forwards;
    }

    .slider-container:nth-child(1) {
      animation-delay: 0.05s;
    }

    .slider-container:nth-child(2) {
      animation-delay: 0.1s;
    }

    .slider-container:nth-child(3) {
      animation-delay: 0.15s;
    }

    .option-container {
      animation: fadeIn 0.3s ease 0.2s forwards;
      opacity: 0;
    }

    .button-container {
      animation: fadeIn 0.3s ease 0.25s forwards;
      opacity: 0;
    }

    .footer {
      animation: fadeIn 0.3s ease 0.3s forwards;
      opacity: 0;
    }
  </style>
</head>

<body>
  <h2>Opacity Randomizer</h2>

  <div class="slider-container">
    <div class="slider-label">
      <span class="slider-label-text" data-tooltip="Lowest opacity value for randomization">Minimum Opacity</span>
      <div class="input-container">
        <input type="number" id="min-input" min="0" max="100" value="50" class="percent-input">
        <span class="percent-symbol">%</span>
      </div>
    </div>
    <div class="slider-wrapper">
      <input type="range" id="min-opacity" min="0" max="100" value="50">
    </div>
  </div>

  <div class="slider-container">
    <div class="slider-label">
      <span class="slider-label-text" data-tooltip="Highest opacity value for randomization">Maximum Opacity</span>
      <div class="input-container">
        <input type="number" id="max-input" min="0" max="100" value="100" class="percent-input">
        <span class="percent-symbol">%</span>
      </div>
    </div>
    <div class="slider-wrapper">
      <input type="range" id="max-opacity" min="0" max="100" value="100">
    </div>
  </div>

  <div class="slider-container">
    <div class="slider-label">
      <span class="slider-label-text" data-tooltip="Increment between possible opacity values">Opacity Step</span>
      <div class="input-container">
        <input type="number" id="step-input" min="1" max="100" value="1" class="percent-input">
      </div>
    </div>
    <div class="slider-wrapper">
      <input type="range" id="opacity-step" min="1" max="100" value="1">
    </div>
  </div>

  <div class="divider"></div>

  <div class="option-container" style="margin-bottom: 8px; justify-content: space-between;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <label for="preview-mode" class="option-label">
        <div class="checkbox-wrapper">
          <input type="checkbox" id="preview-mode" checked>
          <span class="checkbox-custom"></span>
        </div>
        <span>Live Preview</span>
      </label>
      <div class="tooltip" id="preview-tooltip">?
        <span class="tooltiptext">When enabled, shows real-time preview of opacity changes. Disable to see original
          values.</span>
      </div>
    </div>
    <button id="randomize-btn" class="randomize-btn has-tooltip"
      data-tooltip="Apply new random values">Randomize</button>
  </div>

  <div class="option-container">
    <label for="deep-randomize" class="option-label">
      <div class="checkbox-wrapper">
        <input type="checkbox" id="deep-randomize">
        <span class="checkbox-custom"></span>
      </div>
      <span>Randomize children in groups/frames</span>
    </label>
    <div class="tooltip" id="deep-tooltip">?
      <span class="tooltiptext">When enabled, applies randomization to individual elements within groups and frames
        instead of the parent container.</span>
    </div>
  </div>

  <div class="button-container">
    <button id="cancel-btn" class="has-tooltip" data-tooltip="Revert to original values">Cancel</button>
    <button id="apply-btn" class="has-tooltip" data-tooltip="Apply randomization and close">Apply</button>
  </div>

  <div class="footer">
    <span>© 2025 <a href="https://samolevsky.com/" target="_blank">Samolevsky.com</a></span>
    <button class="support-button" id="support-btn" data-tooltip="Support plugin development">
      <svg id="support-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
        <path d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z" />
        <path d="M11.5,11A2.5,2.5,0,1,0,14,13.5,2.48,2.48,0,0,0,11.5,11Z" />
        <path d="M20.5,11A2.5,2.5,0,1,0,23,13.5,2.48,2.48,0,0,0,20.5,11Z" />
        <path d="M16,24a8,8,0,0,0,6.85-3.89l-1.71-1a6,6,0,0,1-10.28,0l-1.71,1A8,8,0,0,0,16,24Z" />
      </svg>
    </button>
  </div>

  <script>
    // Detect and apply Figma theme
    function applyTheme() {
      // Check if dark mode is enabled in Figma
      const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (isDark) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    // Apply theme on load
    applyTheme();

    // Listen for theme changes
    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
    }

    // Initialize values
    let minOpacity = 50;
    let maxOpacity = 100;
    let opacityStep = 1;
    let deepRandomize = false;
    let previewMode = true;

    // Get elements
    const minSlider = document.getElementById('min-opacity');
    const maxSlider = document.getElementById('max-opacity');
    const stepSlider = document.getElementById('opacity-step');
    const minInput = document.getElementById('min-input');
    const maxInput = document.getElementById('max-input');
    const stepInput = document.getElementById('step-input');
    const deepRandomizeCheckbox = document.getElementById('deep-randomize');
    const previewModeCheckbox = document.getElementById('preview-mode');
    const applyBtn = document.getElementById('apply-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const randomizeBtn = document.getElementById('randomize-btn');


    // Function to update slider track progress
    function updateSliderTrack(slider) {
      const value = slider.value;
      const min = slider.min;
      const max = slider.max;
      const percentage = ((value - min) / (max - min)) * 100;
      slider.style.setProperty('--progress', percentage + '%');
    }

    // Function to send preview update to plugin
    function updatePreview() {
      if (previewMode) {
        parent.postMessage({
          pluginMessage: {
            type: 'preview-opacity',
            minOpacity,
            maxOpacity,
            step: opacityStep,
            deepRandomize
          }
        }, '*');
      } else {
        parent.postMessage({
          pluginMessage: {
            type: 'restore-original'
          }
        }, '*');
      }
    }

    // Update displays and trigger preview
    function updateValues() {
      // Update input fields
      minInput.value = minOpacity;
      maxInput.value = maxOpacity;
      stepInput.value = opacityStep;

      // Ensure slider values match the opacity values
      if (minOpacity !== parseInt(minSlider.value)) {
        minSlider.value = minOpacity;
      }

      if (maxOpacity !== parseInt(maxSlider.value)) {
        maxSlider.value = maxOpacity;
      }

      if (opacityStep !== parseInt(stepSlider.value)) {
        stepSlider.value = opacityStep;
      }

      // Update slider tracks
      updateSliderTrack(minSlider);
      updateSliderTrack(maxSlider);
      updateSliderTrack(stepSlider);

      // Update live preview
      updatePreview();
    }

    // Event listeners for sliders
    minSlider.addEventListener('input', () => {
      minOpacity = parseInt(minSlider.value);

      // If min reaches or exceeds max, automatically move max slider to match
      if (minOpacity >= maxOpacity) {
        maxOpacity = minOpacity;
        maxSlider.value = maxOpacity;
      }

      updateValues();
    });

    maxSlider.addEventListener('input', () => {
      maxOpacity = parseInt(maxSlider.value);

      // If max reaches or falls below min, automatically move min slider to match
      if (maxOpacity <= minOpacity) {
        minOpacity = maxOpacity;
        minSlider.value = minOpacity;
      }

      updateValues();
    });

    // Event listener for step slider
    stepSlider.addEventListener('input', () => {
      opacityStep = parseInt(stepSlider.value);
      updateValues();
    });

    // Right-click reset functionality for sliders
    minSlider.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      minOpacity = 0;
      updateValues();
    });

    maxSlider.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      maxOpacity = 100;
      updateValues();
    });

    stepSlider.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      opacityStep = 1;
      updateValues();
    });

    // Event listeners for input fields
    minInput.addEventListener('change', () => {
      // Ensure value is within range
      let value = parseInt(minInput.value);
      value = Math.max(0, Math.min(100, value));
      minOpacity = value;

      // If min reaches or exceeds max, automatically adjust max to match
      if (minOpacity >= maxOpacity) {
        maxOpacity = minOpacity;
      }

      updateValues();
    });

    maxInput.addEventListener('change', () => {
      // Ensure value is within range
      let value = parseInt(maxInput.value);
      value = Math.max(0, Math.min(100, value));
      maxOpacity = value;

      // If max reaches or falls below min, automatically adjust min to match
      if (maxOpacity <= minOpacity) {
        minOpacity = maxOpacity;
      }

      updateValues();
    });

    stepInput.addEventListener('change', () => {
      // Ensure value is within range
      let value = parseInt(stepInput.value);
      value = Math.max(1, Math.min(100, value));
      opacityStep = value;

      updateValues();
    });

    // Prevent non-numeric input
    minInput.addEventListener('input', () => {
      minInput.value = minInput.value.replace(/[^0-9]/g, '');
    });

    maxInput.addEventListener('input', () => {
      maxInput.value = maxInput.value.replace(/[^0-9]/g, '');
    });

    stepInput.addEventListener('input', () => {
      stepInput.value = stepInput.value.replace(/[^0-9]/g, '');
    });

    // Keyboard event handlers for Shift + Arrow keys (10-step increment)
    minInput.addEventListener('keydown', (e) => {
      if (e.shiftKey && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
        e.preventDefault();
        let value = parseInt(minInput.value) || 0;
        value = e.key === 'ArrowUp' ? value + 10 : value - 10;
        value = Math.max(0, Math.min(100, value));
        minOpacity = value;

        if (minOpacity >= maxOpacity) {
          maxOpacity = minOpacity;
        }

        updateValues();
      }
    });

    maxInput.addEventListener('keydown', (e) => {
      if (e.shiftKey && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
        e.preventDefault();
        let value = parseInt(maxInput.value) || 0;
        value = e.key === 'ArrowUp' ? value + 10 : value - 10;
        value = Math.max(0, Math.min(100, value));
        maxOpacity = value;

        if (maxOpacity <= minOpacity) {
          minOpacity = maxOpacity;
        }

        updateValues();
      }
    });

    stepInput.addEventListener('keydown', (e) => {
      if (e.shiftKey && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
        e.preventDefault();
        let value = parseInt(stepInput.value) || 1;
        value = e.key === 'ArrowUp' ? value + 10 : value - 10;
        value = Math.max(1, Math.min(100, value));
        opacityStep = value;

        updateValues();
      }
    });

    // Event listeners for checkboxes
    deepRandomizeCheckbox.addEventListener('change', () => {
      deepRandomize = deepRandomizeCheckbox.checked;
      updatePreview();
    });

    previewModeCheckbox.addEventListener('change', () => {
      previewMode = previewModeCheckbox.checked;
      randomizeBtn.disabled = !previewMode;
      updatePreview();
    });

    // Send message to plugin code
    applyBtn.addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: {
          type: 'apply-opacity',
          minOpacity,
          maxOpacity,
          step: opacityStep,
          deepRandomize
        }
      }, '*');
    });

    cancelBtn.addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: {
          type: 'cancel',
          deepRandomize: deepRandomize
        }
      }, '*');
    });

    randomizeBtn.addEventListener('click', () => {
      if (previewMode) {
        parent.postMessage({
          pluginMessage: {
            type: 'randomize',
            minOpacity,
            maxOpacity,
            step: opacityStep,
            deepRandomize
          }
        }, '*');
      }
    });

    // Listen for messages from the plugin
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      if (message && message.type === 'selection-changed') {
        // Update selection count indicator if needed
        console.log(`Selection changed: ${message.count} objects selected`);

        // Update preview with latest settings
        parent.postMessage({
          pluginMessage: {
            type: 'selection-changed',
            minOpacity,
            maxOpacity,
            step: opacityStep,
            deepRandomize
          }
        }, '*');
      }
    };

    // Support button functionality
    const supportBtn = document.getElementById('support-btn');
    const supportIcon = document.getElementById('support-icon');

    // SVG paths for the two icons
    const icon1Paths = `<path d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z"/>
        <path d="M11.5,11A2.5,2.5,0,1,0,14,13.5,2.48,2.48,0,0,0,11.5,11Z"/>
        <path d="M20.5,11A2.5,2.5,0,1,0,23,13.5,2.48,2.48,0,0,0,20.5,11Z"/>
        <path d="M16,24a8,8,0,0,0,6.85-3.89l-1.71-1a6,6,0,0,1-10.28,0l-1.71,1A8,8,0,0,0,16,24Z"/>`;

    const icon2Paths = `<path d="M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,26A12,12,0,1,1,28,16,12,12,0,0,1,16,28Z"/>
        <path d="M20.5,11A2.5,2.5,0,1,0,23,13.5,2.5,2.5,0,0,0,20.5,11Z"/>
        <rect x="8" y="13" width="6" height="2"/>
        <path d="M16,24a8,8,0,0,0,6.85-3.89l-1.71-1a6,6,0,0,1-10.28,0l-1.71,1A8,8,0,0,0,16,24Z"/>`;

    supportBtn.addEventListener('mouseenter', () => {
      supportIcon.innerHTML = icon2Paths;
    });

    supportBtn.addEventListener('mouseleave', () => {
      supportIcon.innerHTML = icon1Paths;
    });

    supportBtn.addEventListener('click', () => {
      parent.postMessage({
        pluginMessage: {
          type: 'open-url',
          url: 'https://www.patreon.com/c/samolevsky'
        }
      }, '*');
    });

    // Initialize preview and tracks on load
    updateValues();

    // Position tooltips dynamically to avoid cropping
    document.querySelectorAll('.tooltip').forEach(tooltip => {
      tooltip.addEventListener('mouseenter', function (e) {
        const tooltipText = this.querySelector('.tooltiptext');
        if (tooltipText) {
          const rect = this.getBoundingClientRect();
          const tooltipRect = tooltipText.getBoundingClientRect();

          // Position tooltip above the icon
          tooltipText.style.bottom = (rect.height + 8) + 'px';
          tooltipText.style.left = 'auto';
          tooltipText.style.right = 'auto';
          tooltipText.style.transform = 'translateX(-50%)';
          tooltipText.style.marginLeft = '0';

          // Check if tooltip would overflow on the right
          if (rect.left + tooltipRect.width / 2 > window.innerWidth) {
            tooltipText.style.left = 'auto';
            tooltipText.style.right = '0';
            tooltipText.style.transform = 'none';
          }
          // Check if tooltip would overflow on the left
          else if (rect.left - tooltipRect.width / 2 < 0) {
            tooltipText.style.left = '0';
            tooltipText.style.right = 'auto';
            tooltipText.style.transform = 'none';
          }
          else {
            tooltipText.style.left = '50%';
            tooltipText.style.transform = 'translateX(-50%)';
          }
        }
      });
    });
  </script>
</body>

</html>